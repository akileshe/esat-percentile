<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ESAT Percentile Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    body { font-family: Inter, sans-serif; background:#eef0f5; margin:0; padding:40px 20px; display:flex; justify-content:center; }
    .container { background:#fff; padding:32px; border-radius:16px; box-shadow:0 8px 24px rgba(0,0,0,0.08); max-width:900px; width:100%; }
    h1 { font-size:26px; margin-bottom:8px; font-weight:600; }
    .subtitle { color:#555; font-size:15px; margin-bottom:24px; }
    .subjects-row { display:flex; flex-wrap:wrap; gap:16px; margin-bottom:16px; }
    .subject { flex:1; min-width:200px; display:flex; flex-direction:column; gap:8px; }
    label { font-size:14px; font-weight:600; margin-bottom:4px; }
    select, input { width:100%; padding:8px 10px; border:1px solid #ccc; border-radius:8px; font-size:15px; }
    button { padding:12px 20px; border-radius:10px; border:none; background:#2563eb; color:#fff; font-size:15px; font-weight:600; cursor:pointer; transition:background 0.2s; }
    button:hover { background:#1d4ed8; }
    table { width:100%; border-collapse:collapse; margin-top:20px; }
    th, td { text-align:left; padding:10px 8px; border-bottom:1px solid #eee; font-size:15px; }
    th { background:#f8fafc; font-weight:600; }
    .percent { font-weight:600; }
    .note { margin-top:14px; font-size:13px; color:#666; line-height:1.45; }
    .source { margin-top:10px; font-size:13px; }
    .source a { color:#2563eb; font-weight:bold; font-style:italic; }
  </style>
</head>

<body>
  <div class="container">
    <h1>ESAT Percentile Calculator</h1>

    <div class="subtitle">
      Choose three modules and provide separate scores (1.0–9.0).  
      Percentiles are estimated for UK, Overseas, China, and an Overall group (October data only).
    </div>

    <!-- MODULE + SCORE ROW -->
    <div class="subjects-row">

      <div class="subject">
        <div><label for="module1">Module 1</label>
          <select id="module1">
            <option value="maths1">Mathematics 1</option>
            <option value="maths2">Mathematics 2</option>
            <option value="biology">Biology</option>
            <option value="chemistry">Chemistry</option>
            <option value="physics">Physics</option>
          </select>
        </div>
        <div><label for="score1">Score 1</label>
          <input id="score1" type="number" min="1" max="9" step="0.1" value="4.5">
        </div>
      </div>

      <div class="subject">
        <div><label for="module2">Module 2</label>
          <select id="module2">
            <option value="maths1">Mathematics 1</option>
            <option value="maths2">Mathematics 2</option>
            <option value="biology">Biology</option>
            <option value="chemistry">Chemistry</option>
            <option value="physics">Physics</option>
          </select>
        </div>
        <div><label for="score2">Score 2</label>
          <input id="score2" type="number" min="1" max="9" step="0.1" value="4.5">
        </div>
      </div>

      <div class="subject">
        <div><label for="module3">Module 3</label>
          <select id="module3">
            <option value="maths1">Mathematics 1</option>
            <option value="maths2">Mathematics 2</option>
            <option value="biology">Biology</option>
            <option value="chemistry">Chemistry</option>
            <option value="physics">Physics</option>
          </select>
        </div>
        <div><label for="score3">Score 3</label>
          <input id="score3" type="number" min="1" max="9" step="0.1" value="4.5">
        </div>
      </div>

    </div>

    <button onclick="calculate()">Calculate</button>
    <div id="results"></div>

    <div class="note">
      The Overall row uses **October-only** percentile anchors (Table 5).  
      UK, Overseas and China rows use demographic-specific anchors (Tables 8 & 9).
    </div>

    <!-- CLICKABLE SOURCE LINK -->
    <div class="source">
      <em><strong>
        Source: Data derived from UAT’s ESAT Technical Report 2024–25, available at:<br>
        <a href="https://uat-wp.s3.eu-west-2.amazonaws.com/wp-content/uploads/2025/09/24125922/UAT-UK-ESAT-Technical-Report-2024-25-Final.pdf" target="_blank">
          https://uat-wp.s3.eu-west-2.amazonaws.com/wp-content/uploads/2025/09/24125922/UAT-UK-ESAT-Technical-Report-2024-25-Final.pdf
        </a>
      </strong></em>
    </div>
  </div>

  <script>
    const data = {
      maths1:{label:'Mathematics 1', UK:{p25:3.1,p50:3.9,p75:4.8,p90:5.6}, Overseas:{p25:4.0,p50:5.1,p75:6.4,p90:8.0}, China:{p25:4.7,p50:5.8,p75:7.1,p90:8.5}},
      maths2:{label:'Mathematics 2', UK:{p25:3.1,p50:4.1,p75:5.0,p90:5.7}, Overseas:{p25:3.8,p50:4.9,p75:6.3,p90:7.6}, China:{p25:4.5,p50:5.6,p75:6.8,p90:8.2}},
      biology:{label:'Biology', UK:{p25:3.6,p50:4.5,p75:5.4,p90:7.0}, Overseas:{p25:3.6,p50:4.9,p75:5.9,p90:7.0}, China:{p25:4.0,p50:5.0,p75:6.4,p90:7.6}},
      chemistry:{label:'Chemistry', UK:{p25:3.4,p50:4.4,p75:5.2,p90:6.2}, Overseas:{p25:3.8,p50:4.9,p75:6.4,p90:7.6}, China:{p25:4.5,p50:5.6,p75:6.8,p90:8.2}},
      physics:{label:'Physics', UK:{p25:3.2,p50:4.1,p75:5.0,p90:6.0}, Overseas:{p25:3.8,p50:4.9,p75:6.2,p90:7.5}, China:{p25:4.5,p50:5.6,p75:6.8,p90:8.0}}
    };

    // October-only overall anchors
    const overallOct = {
      maths1:{p25:3.4,p50:4.5,p75:5.7,p90:7.0},
      biology:{p25:3.6,p50:4.5,p75:5.9,p90:7.0},
      chemistry:{p25:3.4,p50:4.5,p75:5.8,p90:7.0},
      physics:{p25:3.4,p50:4.5,p75:5.6,p90:7.0},
      maths2:{p25:3.6,p50:4.5,p75:5.6,p90:7.0}
    };

    function interp(score, thr) {
      const pts = [
        {p:25,s:thr.p25},{p:50,s:thr.p50},{p:75,s:thr.p75},{p:90,s:thr.p90}
      ];
      if (score <= pts[0].s) return Math.max(0, 25 * (score / pts[0].s));
      for (let i=0;i<pts.length-1;i++){
        const low=pts[i], high=pts[i+1];
        if (score >= low.s && score <= high.s) {
          return low.p + (score - low.s) * (high.p - low.p) / (high.s - low.s);
        }
      }
      const last = pts[pts.length-1];
      const slope = (100 - 90) / (10 - last.s);
      return Math.min(100, 90 + (score - last.s) * slope);
    }

    function calculate() {
      const modules = [
        document.getElementById('module1').value,
        document.getElementById('module2').value,
        document.getElementById('module3').value
      ];
      const scores = [
        parseFloat(document.getElementById('score1').value),
        parseFloat(document.getElementById('score2').value),
        parseFloat(document.getElementById('score3').value)
      ];

      for (const s of scores) {
        if (isNaN(s) || s < 1 || s > 9) {
          document.getElementById('results').innerHTML =
            '<p>Please enter valid scores between 1.0 and 9.0.</p>';
          return;
        }
      }

      const groups = ['Overall','UK','Overseas','China'];
      let html='<h2>Results</h2><table><tr><th>Group</th>';

      modules.forEach(key => { html += '<th>'+data[key].label+'</th>'; });
      html+='</tr>';

      groups.forEach(g => {
        html+='<tr><td>'+g+'</td>';
        modules.forEach((k,idx)=>{
          const score = scores[idx];
          const thr = (g==='Overall') ? overallOct[k] : data[k][g];
          const pct = interp(score,thr);
          html+='<td class="percent">'+pct.toFixed(1)+'%</td>';
        });
        html+='</tr>';
      });

      html+='</table>';
      document.getElementById('results').innerHTML = html;
    }

    calculate();
  </script>
</body>
</html>
